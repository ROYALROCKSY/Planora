{% extends "base.html" %}
{% block title %}Preferences{% endblock %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/preferences.css') }}">
<script src="{{ url_for('static', filename='js/preferences.js') }}" defer></script>

<div class="preferences-container">
    <h1>User Preferences</h1>

    <form method="POST" action="{{ url_for('preferences.preferences') }}">

        <!-- Sleep & Study Time -->
        <div class="pref-card">
            <div class="pref-card-header"><h2>Study Preferences</h2></div>
            <div class="pref-card-body">
                <div class="pref-form-row">
                    <div class="pref-form-group">
                        <label for="sleep_schedule">Sleep Schedule</label>
                        {% if edit_mode %}
                            <select id="sleep_schedule" name="sleep_schedule" required>
                                <option value="Early bird" {% if preferences.sleep_schedule == 'Early bird' %}selected{% endif %}>Early bird</option>
                                <option value="Night owl" {% if preferences.sleep_schedule == 'Night owl' %}selected{% endif %}>Night owl</option>
                                <option value="Flexible" {% if preferences.sleep_schedule == 'Flexible' %}selected{% endif %}>Flexible</option>
                            </select>
                        {% else %}
                            <div class="pref-display-value">{{ preferences.sleep_schedule }}</div>
                        {% endif %}
                    </div>

                    <div class="pref-form-group">
                        <label for="morning_evening_person">Best Study Time</label>
                        {% if edit_mode %}
                            <select id="morning_evening_person" name="morning_evening_person" required>
                                <option value="Morning" {% if preferences.morning_evening_person == 'Morning' %}selected{% endif %}>Morning</option>
                                <option value="Evening" {% if preferences.morning_evening_person == 'Evening' %}selected{% endif %}>Evening</option>
                                <option value="Both" {% if preferences.morning_evening_person == 'Both' %}selected{% endif %}>Both</option>
                            </select>
                        {% else %}
                            <div class="pref-display-value">{{ preferences.morning_evening_person }}</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Subjects -->
        <div class="pref-card">
            <div class="pref-card-header"><h2>Subjects</h2></div>
            <div class="pref-card-body" id="subjects-container">
                {% if edit_mode %}
                    {% for subject in preferences.subjects %}
                        <input type="text" name="subjects" value="{{ subject }}" class="pref-input">
                    {% endfor %}
                    <button type="button" id="add-subject-btn" class="pref-btn pref-btn-secondary">+ Add Subject</button>
                {% else %}
                    {% for subject in preferences.subjects %}
                        <span class="pref-tag">{{ subject }}</span>
                    {% endfor %}
                {% endif %}
            </div>
        </div>

        <!-- Motivation & Difficulties -->
        <div class="pref-card">
            <div class="pref-card-header"><h2>Motivation & Challenges</h2></div>
            <div class="pref-card-body">
                <div class="pref-form-group">
                    <label>Motivation</label>
                    {% if edit_mode %}
                        <select name="motivation" id="motivation">
                            <option value="Grades" {% if preferences.motivation == 'Grades' %}selected{% endif %}>Grades</option>
                            <option value="Knowledge" {% if preferences.motivation == 'Knowledge' %}selected{% endif %}>Knowledge</option>
                            <option value="Competition" {% if preferences.motivation == 'Competition' %}selected{% endif %}>Competition</option>
                            <option value="Routine" {% if preferences.motivation == 'Routine' %}selected{% endif %}>Routine</option>
                        </select>
                        <button type="button" id="add-custom-motivation-btn" class="pref-btn pref-btn-secondary">+ Custom Motivation</button>
                    {% else %}
                        <div class="pref-display-value">{{ preferences.motivation }}</div>
                    {% endif %}
                </div>

                <div class="pref-form-group">
                    <label>Study Difficulties</label>
                    {% if edit_mode %}
                        <div class="pref-checkbox-grid">
                            <label><input type="checkbox" name="difficulties" value="Procrastination" {% if 'Procrastination' in preferences.difficulties %}checked{% endif %}> Procrastination</label>
                            <label><input type="checkbox" name="difficulties" value="Distractions" {% if 'Distractions' in preferences.difficulties %}checked{% endif %}> Distractions</label>
                            <label><input type="checkbox" name="difficulties" value="Lack of interest" {% if 'Lack of interest' in preferences.difficulties %}checked{% endif %}> Lack of interest</label>
                            <label><input type="checkbox" name="difficulties" value="Fatigue" {% if 'Fatigue' in preferences.difficulties %}checked{% endif %}> Fatigue</label>
                        </div>
                        <button type="button" id="add-custom-difficulty-btn" class="pref-btn pref-btn-secondary">+ Custom Difficulty</button>
                    {% else %}
                        <div class="pref-tags-container">
                            {% for diff in preferences.difficulties %}
                                <span class="pref-tag">{{ diff }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="pref-actions">
            {% if edit_mode %}
                <button type="submit" class="pref-btn pref-btn-primary">Save Changes</button>
                <a href="{{ url_for('preferences.preferences') }}" class="pref-btn pref-btn-secondary">Cancel</a>
            {% else %}
                <a href="{{ url_for('preferences.preferences', edit=1) }}" class="pref-btn pref-btn-primary">Edit Preferences</a>
            {% endif %}
        </div>
    </form>
</div>
{% endblock %}
